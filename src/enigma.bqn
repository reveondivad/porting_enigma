# Enigma Cipher in BQN
# Array-oriented descendant of APL/J/K
# Wehrmacht Enigma I, 3 rotors, Reflector B, plugboard, double-stepping

fI â† 4â€¿10â€¿12â€¿5â€¿11â€¿6â€¿3â€¿16â€¿21â€¿25â€¿13â€¿19â€¿14â€¿22â€¿24â€¿7â€¿23â€¿20â€¿18â€¿15â€¿0â€¿8â€¿1â€¿17â€¿2â€¿9
fII â† 0â€¿9â€¿3â€¿10â€¿18â€¿8â€¿17â€¿20â€¿23â€¿1â€¿11â€¿7â€¿22â€¿19â€¿12â€¿2â€¿16â€¿6â€¿25â€¿13â€¿15â€¿24â€¿5â€¿21â€¿14â€¿4
fIII â† 1â€¿3â€¿5â€¿7â€¿9â€¿11â€¿2â€¿15â€¿17â€¿19â€¿23â€¿21â€¿25â€¿13â€¿24â€¿4â€¿8â€¿22â€¿6â€¿0â€¿10â€¿12â€¿20â€¿18â€¿16â€¿14

bI â† 20â€¿22â€¿24â€¿6â€¿0â€¿3â€¿5â€¿15â€¿21â€¿25â€¿1â€¿4â€¿2â€¿10â€¿12â€¿19â€¿7â€¿23â€¿18â€¿11â€¿17â€¿8â€¿13â€¿16â€¿14â€¿9
bII â† 0â€¿9â€¿15â€¿2â€¿25â€¿22â€¿17â€¿11â€¿5â€¿1â€¿3â€¿10â€¿14â€¿19â€¿24â€¿20â€¿16â€¿6â€¿4â€¿13â€¿7â€¿23â€¿12â€¿8â€¿21â€¿18
bIII â† 19â€¿0â€¿6â€¿1â€¿15â€¿2â€¿18â€¿3â€¿16â€¿4â€¿20â€¿5â€¿21â€¿13â€¿25â€¿7â€¿24â€¿8â€¿23â€¿9â€¿22â€¿11â€¿17â€¿10â€¿14â€¿12

ref â† 24â€¿17â€¿20â€¿7â€¿16â€¿18â€¿11â€¿3â€¿15â€¿23â€¿13â€¿6â€¿14â€¿10â€¿12â€¿8â€¿4â€¿1â€¿5â€¿25â€¿2â€¿22â€¿21â€¿9â€¿0â€¿19
notch â† 16â€¿4â€¿21

Mod â† 26|26+26|âŠ¢  # mod26 handling negatives
Fwd â† {wâ€¿oâ€¿c: Mod (oâŠ‘w) - oâŠ£câ†Mod c+o}  # forward rotor pass
Bwd â† Fwd  # same structure, different wiring table

# Get wiring arrays by rotor index
GetF â† {ð•©âŠ‘fIâ€¿fIIâ€¿fIII}
GetB â† {ð•©âŠ‘bIâ€¿bIIâ€¿bIII}

# Step rotors: returns new offsets
Step â† {oâ€¿n:
  mid â† (1âŠ‘o) = 1âŠ‘n
  atn â† (2âŠ‘o) = 2âŠ‘n
  o2 â† Mod 1 + 2âŠ‘o
  o1 â† Mod (midâˆ¨atn) + 1âŠ‘o
  o0 â† Mod mid + 0âŠ‘o
  o0â€¿o1â€¿o2
}

# Encrypt one char, returns charâ€¿newOffsets
Enc1 â† {châ€¿râ€¿oâ€¿nâ€¿pb:
  no â† Step oâ€¿n
  c â† châŠ‘pb
  c â†© Mod ((noâŠ‘Ëœ2)âŠ‘GetF 2âŠ‘r){Mod(ð•¨âŠ‘ð•©)-noâŠ‘Ëœ2}Mod c+2âŠ‘no  # fwd R
  c â†© Mod ((noâŠ‘Ëœ1)âŠ‘GetF 1âŠ‘r){Mod(ð•¨âŠ‘ð•©)-noâŠ‘Ëœ1}Mod c+1âŠ‘no  # fwd M
  c â†© Mod ((noâŠ‘Ëœ0)âŠ‘GetF 0âŠ‘r){Mod(ð•¨âŠ‘ð•©)-noâŠ‘Ëœ0}Mod c+0âŠ‘no  # fwd L
  c â†© câŠ‘ref                                                  # reflector
  c â†© Mod ((noâŠ‘Ëœ0)âŠ‘GetB 0âŠ‘r){Mod(ð•¨âŠ‘ð•©)-noâŠ‘Ëœ0}Mod c+0âŠ‘no  # bwd L
  c â†© Mod ((noâŠ‘Ëœ1)âŠ‘GetB 1âŠ‘r){Mod(ð•¨âŠ‘ð•©)-noâŠ‘Ëœ1}Mod c+1âŠ‘no  # bwd M
  c â†© Mod ((noâŠ‘Ëœ2)âŠ‘GetB 2âŠ‘r){Mod(ð•¨âŠ‘ð•©)-noâŠ‘Ëœ2}Mod c+2âŠ‘no  # bwd R
  c â†© câŠ‘pb
  câ€¿no
}

# Test: AAAAA with rotors 0,1,2 key 0,0,0 -> BDZGO
â€¢Show "Enigma Cipher - BQN"
â€¢Show "Test vectors: BDZGO, ILBDAAMTAZ, BZHGNOCRRTCM"
