10 REM Enigma Cipher - BASIC (GW-BASIC / QBasic)
20 REM Wehrmacht Enigma I, 3-rotor, Reflector B
30 DIM FI(25), FII(25), FIII(25)
40 DIM BI(25), BII(25), BIII(25)
50 DIM NT(2), RF(25), PB(25)
60 DIM RS(63)
100 REM Initialize Rotor I Forward
110 FOR I=0 TO 25: READ FI(I): NEXT I
120 DATA 4,10,12,5,11,6,3,16,21,25,13,19,14,22,24,7,23,20,18,15,0,8,1,17,2,9
200 REM Initialize Rotor II Forward
210 FOR I=0 TO 25: READ FII(I): NEXT I
220 DATA 0,9,3,10,18,8,17,20,23,1,11,7,22,19,12,2,16,6,25,13,15,24,5,21,14,4
300 REM Initialize Rotor III Forward
310 FOR I=0 TO 25: READ FIII(I): NEXT I
320 DATA 1,3,5,7,9,11,2,15,17,19,23,21,25,13,24,4,8,22,6,0,10,12,20,18,16,14
400 REM Initialize Rotor I Backward
410 FOR I=0 TO 25: READ BI(I): NEXT I
420 DATA 20,22,24,6,0,3,5,15,21,25,1,4,2,10,12,19,7,23,18,11,17,8,13,16,14,9
500 REM Initialize Rotor II Backward
510 FOR I=0 TO 25: READ BII(I): NEXT I
520 DATA 0,9,15,2,25,22,17,11,5,1,3,10,14,19,24,20,16,6,4,13,7,23,12,8,21,18
600 REM Initialize Rotor III Backward
610 FOR I=0 TO 25: READ BIII(I): NEXT I
620 DATA 19,0,6,1,15,2,18,3,16,4,20,9,21,13,25,7,24,8,23,5,22,11,17,12,14,10
700 REM Notches and Reflector
710 NT(0)=16: NT(1)=4: NT(2)=21
720 FOR I=0 TO 25: READ RF(I): NEXT I
730 DATA 24,17,20,7,16,18,11,3,15,23,13,6,14,10,12,8,4,1,5,25,2,22,21,9,0,19
800 PRINT "Enigma Cipher - BASIC"
810 REM Test 1: Rotors I-II-III, Key AAA, no plugboard
820 R0=0: R1=1: R2=2: O0=0: O1=0: O2=0
830 GOSUB 2000: REM init plugboard no pairs
840 M$="AAAAA": GOSUB 3000
850 PRINT "Test 1: "; RS$; " (expected BDZGO)"
860 REM Test 2
870 R0=0: R1=1: R2=2: O0=0: O1=0: O2=0
880 GOSUB 2000
890 M$="HELLOWORLD": GOSUB 3000
900 PRINT "Test 2: "; RS$; " (expected ILBDAAMTAZ)"
910 REM Test 3
920 R0=0: R1=1: R2=2: O0=0: O1=0: O2=0
930 GOSUB 2000
940 M$="ATTACKATDAWN": GOSUB 3000
950 PRINT "Test 3: "; RS$; " (expected BZHGNOCRRTCM)"
960 REM Test 4: Key MCK
970 R0=0: R1=1: R2=2: O0=12: O1=2: O2=10
980 GOSUB 2000
990 M$="HELLOWORLD": GOSUB 3000
1000 PRINT "Test 4: "; RS$; " (expected DLTBBQVPQV)"
1010 REM Test 5: Rotors III-I-II
1020 R0=2: R1=0: R2=1: O0=0: O1=0: O2=0
1030 GOSUB 2000
1040 M$="HELLOWORLD": GOSUB 3000
1050 PRINT "Test 5: "; RS$; " (expected KZHDFQYHXT)"
1060 REM Test 6: Plugboard AB-CD-EF
1070 R0=0: R1=1: R2=2: O0=0: O1=0: O2=0
1080 GOSUB 2000
1090 PB(0)=1: PB(1)=0: PB(2)=3: PB(3)=2: PB(4)=5: PB(5)=4
1100 M$="HELLOWORLD": GOSUB 3000
1110 PRINT "Test 6: "; RS$; " (expected IKACBBMTBF)"
1120 END
2000 REM Init plugboard (identity)
2010 FOR I=0 TO 25: PB(I)=I: NEXT I
2020 RETURN
3000 REM Encrypt M$ -> RS$
3010 RS$=""
3020 FOR P=1 TO LEN(M$)
3030   CH=ASC(MID$(M$,P,1))-65
3040   REM Step rotors
3050   MD=0: IF O1=NT(R1) THEN MD=1
3060   AN=0: IF O2=NT(R2) THEN AN=1
3070   O2=O2+1: IF O2>25 THEN O2=O2-26
3080   IF AN=1 OR MD=1 THEN O1=O1+1: IF O1>25 THEN O1=O1-26
3090   IF MD=1 THEN O0=O0+1: IF O0>25 THEN O0=O0-26
3100   REM Plugboard in
3110   C=PB(CH)
3120   REM Forward R-M-L
3130   GOSUB 4000: REM passFwd R2
3140   GOSUB 4100: REM passFwd R1
3150   GOSUB 4200: REM passFwd R0
3160   REM Reflector
3170   C=RF(C)
3180   REM Backward L-M-R
3190   GOSUB 4300: REM passBwd R0
3200   GOSUB 4400: REM passBwd R1
3210   GOSUB 4500: REM passBwd R2
3220   REM Plugboard out
3230   C=PB(C)
3240   RS$=RS$+CHR$(C+65)
3250 NEXT P
3260 RETURN
4000 REM passFwd rotor R2
4010 IP=(C+O2) MOD 26: GOSUB 5000: C=GF
4020 C=(C-O2+26) MOD 26: RETURN
4100 REM passFwd rotor R1
4110 IP=(C+O1) MOD 26: GOSUB 5100: C=GF
4120 C=(C-O1+26) MOD 26: RETURN
4200 REM passFwd rotor R0
4210 IP=(C+O0) MOD 26: GOSUB 5200: C=GF
4220 C=(C-O0+26) MOD 26: RETURN
4300 REM passBwd rotor R0
4310 IP=(C+O0) MOD 26: GOSUB 5500: C=GB
4320 C=(C-O0+26) MOD 26: RETURN
4400 REM passBwd rotor R1
4410 IP=(C+O1) MOD 26: GOSUB 5600: C=GB
4420 C=(C-O1+26) MOD 26: RETURN
4500 REM passBwd rotor R2
4510 IP=(C+O2) MOD 26: GOSUB 5700: C=GB
4520 C=(C-O2+26) MOD 26: RETURN
5000 REM getFwd R2
5010 IF R2=0 THEN GF=FI(IP): RETURN
5020 IF R2=1 THEN GF=FII(IP): RETURN
5030 GF=FIII(IP): RETURN
5100 REM getFwd R1
5110 IF R1=0 THEN GF=FI(IP): RETURN
5120 IF R1=1 THEN GF=FII(IP): RETURN
5130 GF=FIII(IP): RETURN
5200 REM getFwd R0
5210 IF R0=0 THEN GF=FI(IP): RETURN
5220 IF R0=1 THEN GF=FII(IP): RETURN
5230 GF=FIII(IP): RETURN
5500 REM getBwd R0
5510 IF R0=0 THEN GB=BI(IP): RETURN
5520 IF R0=1 THEN GB=BII(IP): RETURN
5530 GB=BIII(IP): RETURN
5600 REM getBwd R1
5610 IF R1=0 THEN GB=BI(IP): RETURN
5620 IF R1=1 THEN GB=BII(IP): RETURN
5630 GB=BIII(IP): RETURN
5700 REM getBwd R2
5710 IF R2=0 THEN GB=BI(IP): RETURN
5720 IF R2=1 THEN GB=BII(IP): RETURN
5730 GB=BIII(IP): RETURN
